<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Transfer Received</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;">
    <table align="center" border="0" cellpadding="0" cellspacing="0" width="600" style="border-collapse: collapse;">
        <tr>
            <td bgcolor="#4CAF50" style="padding: 20px; text-align: center; color: white;">
                <h1 style="margin: 0; font-size: 24px;">Transfer Received</h1>
            </td>
        </tr>
        <tr>
            <td bgcolor="#ffffff" style="padding: 30px;">
                <p style="font-size: 16px; color: #333;">Hi there,</p>
                <p style="font-size: 16px; color: #333;">
                    Youâ€™ve received a transfer of <strong>{{ amount }}</strong> from <strong>{{ sender_user }}</strong>! Please accept or reject it below.
                </p>
                <h2 style="font-size: 18px; color: #4CAF50; margin-top: 20px;">Details</h2>
                <table style="font-size: 16px; color: #333; width: 100%;">
                    <tr>
                        <td style="padding: 5px 0;">Amount:</td>
                        <td style="padding: 5px 0;"><strong>{{ amount }}</strong></td>
                    </tr>
                    <tr>
                        <td style="padding: 5px 0;">Sender:</td>
                        <td style="padding: 5px 0;"><strong>{{ sender_user }}</strong></td>
                    </tr>
                    <tr>
                        <td style="padding: 5px 0;">Reference:</td>
                        <td style="padding: 5px 0;"><strong>{{ reference }}</strong></td>
                    </tr>
                    <tr>
                        <td style="padding: 5px 0;">Date:</td>
                        <td style="padding: 5px 0;"><strong>{{ created_at|date:"Y-m-d H:i:s" }}</strong></td>
                    </tr>
                </table>
                <p style="font-size: 16px; color: #333; margin-top: 20px;">Act now to complete the transaction:</p>
                <table style="margin-top: 20px;">
                    <tr>
                        <td style="padding-right: 10px;">
                            <button onclick="submitAction('{{ accept_url }}', '{{ token }}', '{{ reference }}', 'accept')"
                                    style="background-color: #4CAF50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-size: 16px; border: none; cursor: pointer;">
                                Accept
                            </button>
                        </td>
                        <td>
                            <button onclick="submitAction('{{ reject_url }}', '{{ token }}', '{{ reference }}', 'reject')"
                                    style="background-color: #f44336; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-size: 16px; border: none; cursor: pointer;">
                                Reject
                            </button>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td bgcolor="#f4f4f4" style="padding: 20px; text-align: center; font-size: 14px; color: #777;">
                <p style="margin: 0;">The Wallet Team</p>
                <p style="margin: 5px 0;">Need help? Contact us at <a href="mailto:support@walletapp.com" style="color: #4CAF50;">support@walletapp.com</a></p>
            </td>
        </tr>
    </table>

    <script>
        async function submitAction(url, token, reference, action) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Option 1: Send JWT in Authorization header
                        'Authorization': `Bearer ${token}`,
                        // Include CSRF token if required (uncomment if needed)
                        // 'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify({
                        // Option 2: Send JWT in body (uncomment if needed)
                        // token: token,
                        reference: reference,
                        action: action
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    alert(`Transaction ${action}ed successfully!`);
                    // Optionally redirect or refresh
                    // window.location.reload();
                } else {
                    alert(`Error: ${data.error || 'Failed to process action'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        // Helper function to get CSRF token from cookies (if needed)
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>